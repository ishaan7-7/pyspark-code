import matplotlib.pyplot as plt
import pandas as pd

# Step 1: Get list of all columns
columns = df.columns
timestamp_col = "timestamp"
signal_cols = [col for col in columns if col.startswith("signal_")]

# Step 2: Cache DataFrame for better performance
df.cache()

# Step 3: Loop through each signal column
for signal in signal_cols:
    print(f"Plotting: {signal}")
    
    # Step 3a: Select timestamp and this signal column
    temp_df = df.select(timestamp_col, signal)
    
    # Step 3b: Limit to a reasonable number of points for plotting (e.g., 5000)
    temp_pdf = temp_df.limit(5000).toPandas()
    
    # Step 3c: Plot using matplotlib
    plt.figure(figsize=(10, 5))
    plt.scatter(temp_pdf[timestamp_col], temp_pdf[signal], s=5, c='blue')
    plt.xlabel("Timestamp")
    plt.ylabel(signal)
    plt.title(f"Scatter Plot of {signal}")
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()
